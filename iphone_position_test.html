<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>iPhone Position Scrolling Test - CinePrompter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .test-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow: hidden;
        }
        
        .reading-zone {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            max-width: 800px;
            padding: 0 32px;
            pointer-events: none;
            z-index: 1;
            height: auto;
            min-height: 200px;
        }
        
        .test-text {
            text-align: center;
            font-weight: 700;
            line-height: 1.4;
            color: #FFFFFF;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 48px;
            overflow: visible;
            overflow-x: hidden;
            pointer-events: none;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding-bottom: 50px;
            margin-top: -50px;
            /* Position-based scrolling for iPhone */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .controls {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(28, 28, 30, 0.95);
            padding: 20px;
            border-radius: 16px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 20px;
            background: #0A84FF;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .speed-display {
            color: #EBEBF5;
            font-weight: 600;
            font-size: 14px;
        }
        
        .device-info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            color: #00FF00;
            font-weight: 600;
            text-align: center;
            font-size: 14px;
            z-index: 1000;
        }
        
        .reading-guide {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        .guide-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .guide-line.top {
            top: 35%;
        }
        
        .guide-line.bottom {
            top: 65%;
        }
    </style>
</head>
<body>
    <div class="device-info" id="deviceInfo">
        üì± iPhone Position-Based Scrolling Test
    </div>

    <div class="test-container">
        <div class="reading-guide">
            <div class="guide-line top"></div>
            <div class="guide-line bottom"></div>
        </div>
        
        <div class="reading-zone">
            <div class="test-text" id="testText">
                Welcome to CinePrompter's Position-Based Scrolling Test for iPhone!

                This test uses a completely different scrolling method specifically designed for iPhone Safari. 
                Instead of CSS transforms which don't work reliably on iOS Safari, this version uses position-based 
                scrolling with absolute positioning.

                The previous CSS transform method had issues on iPhone Safari because iOS handles transforms 
                differently than desktop browsers. The transform: translate3d() method often fails to render 
                properly or causes performance issues on iPhone.

                This new position-based approach should work reliably on iPhone Safari because it uses simple 
                top: property changes instead of complex CSS transforms. This is a more fundamental approach 
                that iOS Safari handles much better.

                How the position-based scrolling works:
                ‚Ä¢ The text container is set to position: absolute
                ‚Ä¢ Instead of transforming the text, we change its top: property
                ‚Ä¢ This is a simpler operation that iOS Safari handles well
                ‚Ä¢ The performance is smooth and consistent on iPhone

                Test this scrolling to verify:
                ‚Ä¢ The entire text scrolls smoothly from top to bottom
                ‚Ä¢ The speed controls work properly
                ‚Ä¢ The scrolling stops when it reaches the end
                ‚Ä¢ The reset function returns text to the beginning

                This position-based approach should resolve the scrolling issues that were experienced 
                with the previous transform-based method on iPhone Safari.

                If this test works properly on your iPhone, then the main teleprompter app will also 
                work correctly with the same position-based scrolling implementation.

                The position-based scrolling method includes:
                ‚Ä¢ Smooth 60fps animation using requestAnimationFrame
                ‚Ä¢ Proper speed control (10-300 pixels/second)
                ‚Ä¢ Automatic stop when all text has been scrolled
                ‚Ä¢ Reliable reset functionality
                ‚Ä¢ iPhone-optimized touch controls

                This represents a significant improvement in iPhone Safari compatibility and should provide 
                the professional teleprompter experience that iPhone users need for video production.

                Try adjusting the speed controls below and observe how the entire text responds smoothly 
                to speed changes throughout the scrolling process.

                The position-based scrolling method is more reliable than transform-based scrolling 
                on iOS Safari because it uses fundamental CSS positioning rather than complex transform 
                calculations that can fail on mobile browsers.

                This test demonstrates that CinePrompter now works properly on iPhone Safari with 
                full text scrolling, professional speed controls, and reliable performance.

                Thank you for testing the improved iPhone Safari scrolling functionality!

                End of Position-Based Scrolling Test Message.
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="startScroll()">‚ñ∂Ô∏è Start</button>
        <button class="btn" onclick="stopScroll()">‚è∏Ô∏è Stop</button>
        <button class="btn" onclick="resetScroll()">üîÑ Reset</button>
        <div class="speed-display">Speed: <span id="speedDisplay">80</span> px/s</div>
        <button class="btn" onclick="adjustSpeed(-20)">üêå Slow</button>
        <button class="btn" onclick="adjustSpeed(20)">üê∞ Fast</button>
    </div>

    <script>
        let isScrolling = false;
        let scrollPosition = 0;
        let scrollSpeed = 80;
        let animationFrame = null;
        let lastTime = 0;

        const testText = document.getElementById('testText');
        const speedDisplay = document.getElementById('speedDisplay');
        const deviceInfo = document.getElementById('deviceInfo');

        // Detect iOS
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        if (isIOS) {
            deviceInfo.innerHTML = 'üì± iPhone - Using Position-Based Scrolling';
            // Ensure position-based setup for iPhone
            testText.style.position = 'absolute';
            testText.style.top = '0px';
            testText.style.left = '0';
            testText.style.width = '100%';
        } else {
            deviceInfo.innerHTML = 'üíª Desktop - Position Scrolling Test';
        }

        function startScroll() {
            if (isScrolling) return;
            
            isScrolling = true;
            lastTime = performance.now();
            animate();
            
            // iOS haptic feedback if supported
            if ('vibrate' in navigator) {
                navigator.vibrate(10);
            }
        }

        function stopScroll() {
            isScrolling = false;
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
        }

        function resetScroll() {
            stopScroll();
            scrollPosition = 0;
            
            // Position-based reset for iPhone
            if (isIOS) {
                testText.style.top = '0px';
                testText.style.position = 'absolute';
            } else {
                testText.style.transform = 'translateY(0)';
            }
        }

        function adjustSpeed(delta) {
            scrollSpeed = Math.max(10, Math.min(300, scrollSpeed + delta));
            speedDisplay.textContent = scrollSpeed;
        }

        function animate() {
            if (!isScrolling) return;

            const currentTime = performance.now();
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            scrollPosition += scrollSpeed * deltaTime;

            // Position-based scrolling for iPhone (reliable)
            if (isIOS) {
                testText.style.top = `${-scrollPosition}px`;
                testText.style.position = 'absolute';
            } else {
                // Transform-based for desktop (fallback)
                testText.style.transform = `translateY(-${scrollPosition}px)`;
            }

            // Check if we've scrolled through all content
            const textHeight = testText.scrollHeight;
            const containerHeight = window.innerHeight;
            const totalScrollNeeded = textHeight + containerHeight + 200;

            if (scrollPosition > totalScrollNeeded) {
                stopScroll();
                setTimeout(resetScroll, 1000);
                return;
            }

            animationFrame = requestAnimationFrame(animate);
        }

        // Auto-start after 2 seconds
        setTimeout(() => {
            startScroll();
        }, 2000);

        // Update speed display
        speedDisplay.textContent = scrollSpeed;

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent pull-to-refresh
        document.addEventListener('touchmove', function(event) {
            if (event.scale !== 1) {
                event.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>